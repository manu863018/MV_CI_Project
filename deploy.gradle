plugins {
  id 'org.hidetake.ssh' version '2.9.0'
}

remotes {
  webServer {
    host = "${dev_server}"
    user = "${user_server}"
    identity = file("${key_path}")
  }
}

task deploy {
  doLast {
    ssh.run {
      session(remotes.webServer) {	
        executeScript file('deploy-app.sh')
        put from: 'Build/sample-dropwizard-rest-stub-1.0-SNAPSHOT-capsule.jar', into: '/home/ubuntu/jar_deploy/'
        put from: 'config.yml', into: '/home/ubuntu/jar_deploy/'
        execute 'nohup java -jar /home/ubuntu/jar_deploy/sample-dropwizard-rest-stub-1.0-SNAPSHOT-capsule.jar server /home/ubuntu/jar_deploy/config.yml &'
      }
    }
  }
}

